<!DOCTYPE html>
<html lang="hy">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aria Converter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.0.379/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; text-align: center; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        select, input, button { margin: 10px; padding: 10px; font-size: 16px; }
        #info { margin: 20px; font-size: 18px; }
        footer { margin-top: 50px; font-size: 14px; }
        @media (max-width: 600px) { .container { padding: 10px; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>Aria Converter</h1>
        <input type="file" id="fileInput" accept=".pdf"/>
        <select id="format">
            <option value="png">PDF → PNG</option>
            <option value="jpg">PDF → JPG</option>
            <option value="ocr">OCR PDF (Տեքստի ճանաչում)</option>
        </select>
        <button onclick="convert()">Փոխակերպել և ներբեռնել ZIP</button>
        <div id="info"></div>
    </div>
    <footer>
        Copyright © | <a href="https://github.com/ariadevelopmentgroup/AriaConverter" target="_blank">Aria Development Group</a> | Հեղինակային բոլոր իրավունքները պաշտպանված են:
    </footer>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.0.379/pdf.worker.min.js';

        async function convert() {
            const file = document.getElementById('fileInput').files[0];
            if (!file || file.type !== 'application/pdf') {
                alert('Ընտրեք PDF ֆայլ');
                return;
            }

            const info = document.getElementById('info');
            info.innerHTML = `Անուն: ${file.name}<br>Չափս: ${(file.size / 1024 / 1024).toFixed(2)} MB`;

            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
            info.innerHTML += `<br>Էջերի քանակ: ${pdf.numPages}`;

            const zip = new JSZip();
            const format = document.getElementById('format').value;

            if (format === 'ocr') {
                info.innerHTML += '<br>OCR գործընթաց (դանդաղ է)...';
                let text = '';
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const viewport = page.getViewport({scale: 2});
                    const canvas = document.createElement('canvas');
                    canvas.width = viewport.width;
                    canvas.height = viewport.height;
                    await page.render({canvasContext: canvas.getContext('2d'), viewport}).promise;
                    const dataUrl = canvas.toDataURL('image/png');
                    const {data: {text: pageText}} = await Tesseract.recognize(dataUrl, 'eng+rus+hy');
                    text += `Էջ ${i}:\n${pageText}\n\n`;
                }
                zip.file('ocr_text.txt', text);
            } else {
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const viewport = page.getViewport({scale: 2});
                    const canvas = document.createElement('canvas');
                    canvas.width = viewport.width;
                    canvas.height = viewport.height;
                    await page.render({canvasContext: canvas.getContext('2d'), viewport}).promise;
                    const blob = await new Promise(resolve => canvas.toBlob(resolve, format === 'png' ? 'image/png' : 'image/jpeg', 0.95));
                    zip.file(`page_${i}.${format}`, blob);
                }
            }

            const date = new Date();
            const fileName = `ARIA-CONVERTER__${date.getDate()}-${date.getMonth()+1}-${date.getFullYear()}.zip`;
            const content = await zip.generateAsync({type: 'blob'});
            saveAs(content, fileName);
            info.innerHTML += '<br>Պատրաստ է!';
        }
    </script>
</body>
</html>